<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Test de la connexion et de la récupération du nom d'utilisateur</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <div class="container">
    <h1 class="my-4">Test de la connexion et de la récupération du nom d'utilisateur</h1>
    <button id="btnLogin" class="btn btn-primary mb-3">Se connecter</button>
<button id="btnGetUsername" class="btn btn-success mb-3">Obtenir le nom d'utilisateur</button>
<div id="divUsername"></div>
</div>
<script>
  // Requête POST pour se connecter et obtenir un jeton d'accès
  $('#btnLogin').click(function() {
    const email = 'Reta.Windler38';
    const password = 'YjFTX0XcobLnL0x';
    $.ajax({
      url: 'http://localhost:3000/api/login',
      type: 'POST',
      data: { email: email, password: password },
      success: function(response) {
        console.log('Jetons d\'accès:', response);
        
        localStorage.setItem('accessToken', response.token);
      },
      error: function(jqXHR, textStatus, errorThrown) {
        console.error('Erreur:', textStatus, errorThrown);
      }
    });
  });

  // Requête GET pour récupérer le nom d'utilisateur
  $('#btnGetUsername').click(function() {
  const accessToken = localStorage.getItem('accessToken');
  console.log(accessToken)
  if (!accessToken) {
    console.log('Jeton d\'accès non trouvé.');
    return;
  }
  $.ajax({
    url: 'http://localhost:3000/api/username',
    type: 'GET',
    headers: { 'Authorization':   accessToken },
    success: function(response) {
      console.log(response)
      $('#divUsername').text('Nom d\'utilisateur: ' + response.username);
    },
    error: function(jqXHR, textStatus, errorThrown) {
      console.error('Erreur:', textStatus, errorThrown);
    }
  });
});



</script>
</body>
</html>